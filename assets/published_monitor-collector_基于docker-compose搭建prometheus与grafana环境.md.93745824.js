import{_ as s,o as a,c as n,Q as o}from"./chunks/framework.36bc40e2.js";const p="/assets/prometheus-archetecture.drawio.9e352bdf.png",l="/assets/grafana-add-datasource.8054553e.png",e="/assets/grafana-config.3ca38ba0.png",c="/assets/grafana-dashboard-default.f24033fd.png",t="/assets/grafana-dashboards.a3dd0b11.png",r="/assets/grafana-prometheus-2.0.36bf2536.png",E="/assets/grafana-dashboards-db.cac4e8dd.png",y="/assets/grafana-node-exporter.f786dee2.png",d="/assets/grafana-import-json.50285a10.png",i="/assets/grafana-node-exporter-config.eff5826b.png",F="/assets/grafana-node-exporter-dashboard.f489ee30.png",A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"published/monitor-collector/基于docker-compose搭建prometheus与grafana环境.md","filePath":"published/monitor-collector/基于docker-compose搭建prometheus与grafana环境.md","lastUpdated":1700106669000}'),u={name:"published/monitor-collector/基于docker-compose搭建prometheus与grafana环境.md"},m=o('<p>手把手式小白入门<code>prometheus</code>与<code>grafana</code>监控系统搭建</p><h2 id="整体架构" tabindex="-1">整体架构 <a class="header-anchor" href="#整体架构" aria-label="Permalink to &quot;整体架构&quot;">​</a></h2><p><img src="'+p+`" alt="prometheus-archetecture.drawio"></p><p>采集与监控流程</p><ul><li>存在一个具体的主机或者服务，存在一些可以被采集的指标，比如<code>linux</code>系统上面的<code>CPU</code>内存等指标</li><li>部署了对应服务或主机的采集程序<code>Exporter</code>，该程序同时提供一个对外暴露的<code>http</code>接口用于提供采集到的数据，通常是开放一个<code>http://{host}:{port}/metrics</code>接口</li><li><code>Prometheus</code>负责定期数据收集，存储以及对外提供查询服务</li><li><code>grafana</code>提供监控数据可视化面板(<code>dashboard</code>)，用于监控数据精美展示</li></ul><h2 id="docker服务配置" tabindex="-1"><code>docker</code>服务配置 <a class="header-anchor" href="#docker服务配置" aria-label="Permalink to &quot;\`docker\`服务配置&quot;">​</a></h2><p>新建<code>compose.yaml</code>如下</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">prometheus</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">prom/prometheus:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-prometheus</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;9090:9090&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">./prometheus.yml:/etc/prometheus/prometheus.yml</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">prometheus-data:/prometheus</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">networks</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">grafana</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana/grafana-enterprise:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-grafana</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">grafana-data:/var/lib/grafana</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">grafana-config:/etc/grafana</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">networks</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">node-exporter</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">quay.io/prometheus/node-exporter:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&#39;--path.rootfs=/host&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">network_mode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">host</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">pid</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">host</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&#39;/:/host:ro,rslave&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">networks</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">demo</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;demo&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">external</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">grafana-data</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">grafana-config</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">prometheus-data</span><span style="color:#E1E4E8;">: {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">services</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">prometheus</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">prom/prometheus:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-prometheus</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart</span><span style="color:#24292E;">: </span><span style="color:#032F62;">unless-stopped</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;9090:9090&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">./prometheus.yml:/etc/prometheus/prometheus.yml</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">prometheus-data:/prometheus</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">networks</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">      </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">grafana</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana/grafana-enterprise:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-grafana</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart</span><span style="color:#24292E;">: </span><span style="color:#032F62;">unless-stopped</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">grafana-data:/var/lib/grafana</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">grafana-config:/etc/grafana</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">networks</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">node-exporter</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">quay.io/prometheus/node-exporter:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-node-exporter</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&#39;--path.rootfs=/host&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">network_mode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">host</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">pid</span><span style="color:#24292E;">: </span><span style="color:#032F62;">host</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart</span><span style="color:#24292E;">: </span><span style="color:#032F62;">unless-stopped</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&#39;/:/host:ro,rslave&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">networks</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">demo</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;demo&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">external</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">grafana-data</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">grafana-config</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">prometheus-data</span><span style="color:#24292E;">: {}</span></span></code></pre></div><p>提供三个服务</p><ul><li><p><code>prometheus</code>服务，用于收集<code>metrics</code>数据</p><ul><li><p>默认开放<code>9090</code>端口</p></li><li><p><code>./prometheus.yml:/etc/prometheus/prometheus.yml</code>：需要外部挂载一个配置文件到容器指定位置，用于定义采集服务的信息等（该文件后面会详细解释）</p></li><li><p><code>prometheus-data:/prometheus</code>: 需要把保存的数据挂载出来，以免容器再次启动时数据丢失</p><p>通过执行如下命令可以大致知道数据卷位置，可以看到镜像定义的<code>volumes</code>的参数只有<code>/prometheus</code>，</p><p>启动命令中也看不到有别的什么需要持久化的数据路径，剩下的<code>/etc/prometheus/</code>，<code>/usr/share/prometheus/</code>可以在查看后自行决定是否挂载</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prom/prometheus:latest</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#B392F0;">&quot;Cmd&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">&quot;--storage.tsdb.path=/prometheus&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">&quot;--web.console.libraries=/usr/share/prometheus/console_libraries&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">&quot;--web.console.templates=/usr/share/prometheus/consoles&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#B392F0;">&quot;Image&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;sha256:c306a8110e4d13dbe51ddeb37b0746b6238819256a338d1cc5d226e04b02a06a&quot;,</span></span>
<span class="line"><span style="color:#B392F0;">&quot;Volumes&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;/prometheus&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{}</span></span>
<span class="line"><span style="color:#E1E4E8;">},</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prom/prometheus:latest</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#6F42C1;">&quot;Cmd&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;--storage.tsdb.path=/prometheus&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;--web.console.libraries=/usr/share/prometheus/console_libraries&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;--web.console.templates=/usr/share/prometheus/consoles&quot;</span></span>
<span class="line"><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#6F42C1;">&quot;Image&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;sha256:c306a8110e4d13dbe51ddeb37b0746b6238819256a338d1cc5d226e04b02a06a&quot;,</span></span>
<span class="line"><span style="color:#6F42C1;">&quot;Volumes&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;/prometheus&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{}</span></span>
<span class="line"><span style="color:#24292E;">},</span></span></code></pre></div></li></ul></li><li><p><code>grafana</code>服务</p><ul><li><p>默认开放端口<code>3000</code></p></li><li><p><code>volumes</code>参数：</p><p>查看容器信息如下，发现路径较多，所以目前只挂载<code>/var/lib/grafana</code>以及<code>/etc/grafana</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">grafana/grafana-enterprise</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">&quot;Env&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">&quot;GF_PATHS_CONFIG=/etc/grafana/grafana.ini&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">&quot;GF_PATHS_DATA=/var/lib/grafana&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">&quot;GF_PATHS_HOME=/usr/share/grafana&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">&quot;GF_PATHS_LOGS=/var/log/grafana&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">&quot;GF_PATHS_PLUGINS=/var/lib/grafana/plugins&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">&quot;GF_PATHS_PROVISIONING=/etc/grafana/provisioning&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> ],</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">&quot;Cmd&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">null,</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">&quot;Image&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">&quot;Volumes&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">null,</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#032F62;">grafana/grafana-enterprise</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">&quot;Env&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">&quot;GF_PATHS_CONFIG=/etc/grafana/grafana.ini&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">&quot;GF_PATHS_DATA=/var/lib/grafana&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">&quot;GF_PATHS_HOME=/usr/share/grafana&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">&quot;GF_PATHS_LOGS=/var/log/grafana&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">&quot;GF_PATHS_PLUGINS=/var/lib/grafana/plugins&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">&quot;GF_PATHS_PROVISIONING=/etc/grafana/provisioning&quot;</span></span>
<span class="line"><span style="color:#24292E;"> ],</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">&quot;Cmd&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">null,</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">&quot;Image&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;,</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">&quot;Volumes&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">null,</span></span></code></pre></div></li></ul></li><li><p><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noreferrer"><code>node-exporter</code></a>作为采集程序（<code>prometheus</code>组织官方提供专门用于采集主机服务指标的程序，可以采集<code>CPU</code>，内存，磁盘，网卡等性能数据）</p><ul><li><p>网络模式使用<code>host</code>模式以便获取到宿主机真实网卡信息</p></li><li><p><code>pid</code>配置为<code>host</code>与宿主机使用相同的<code>pid</code>命名空间，这样可以获取到宿主机所有程序信息</p></li><li><p>以只读方式挂载系统根目录到容器当中，用于获取系统磁盘数据，否则容器内部获取的是容器内部磁盘信息导致数据错误</p></li><li><p>服务默认开放端口9100，服务启动后浏览器访问地址<code>http://127.0.0.1:9100/metrics</code>查看该服务采集到的系统数据</p></li><li><p><code>metrics</code>提供的数据形式如下</p><p>第一行是 <code># HELP</code>开头，用于解释当前指标的含义</p><p>第二行是<code># TYPE</code>开头，说明当前指标的数据类型</p><p>剩下的就是具体采集到的数据</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># HELP node_cooling_device_cur_state Current throttle state of the cooling device</span></span>
<span class="line"><span style="color:#e1e4e8;"># TYPE node_cooling_device_cur_state gauge</span></span>
<span class="line"><span style="color:#e1e4e8;">node_cooling_device_cur_state{name=&quot;0&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#e1e4e8;">node_cooling_device_cur_state{name=&quot;1&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#e1e4e8;">node_cooling_device_cur_state{name=&quot;10&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#e1e4e8;">node_cooling_device_cur_state{name=&quot;11&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#e1e4e8;">node_cooling_device_cur_state{name=&quot;12&quot;,type=&quot;intel_powerclamp&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># HELP node_cooling_device_cur_state Current throttle state of the cooling device</span></span>
<span class="line"><span style="color:#24292e;"># TYPE node_cooling_device_cur_state gauge</span></span>
<span class="line"><span style="color:#24292e;">node_cooling_device_cur_state{name=&quot;0&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#24292e;">node_cooling_device_cur_state{name=&quot;1&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#24292e;">node_cooling_device_cur_state{name=&quot;10&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#24292e;">node_cooling_device_cur_state{name=&quot;11&quot;,type=&quot;Processor&quot;} 0</span></span>
<span class="line"><span style="color:#24292e;">node_cooling_device_cur_state{name=&quot;12&quot;,type=&quot;intel_powerclamp&quot;}</span></span></code></pre></div></li></ul></li></ul><h2 id="prometheus采集配置" tabindex="-1"><code>prometheus</code>采集配置 <a class="header-anchor" href="#prometheus采集配置" aria-label="Permalink to &quot;\`prometheus\`采集配置&quot;">​</a></h2><p>与上面的<code>compose.yaml</code>文件相同目录下，新建<code>prometheus.yml</code>文件，该文件会被挂载到<code>prometheus</code>容器当中</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">global</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 配置全局默认收集metrics间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">scrape_interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">15s</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 当与外部系统通信的时候，会把该配置下的\`label\`信息附加到数据中</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">external_labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">monitor</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;codelab-monitor&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 收集数据的配置</span></span>
<span class="line"><span style="color:#85E89D;">scrape_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;"># 定义收集job名称，此处采集prometheus自己本身的metrics</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">job_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;prometheus&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 收集间隔会覆盖上面的全局配置</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">scrape_interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 配置采集的http的接口位置，这个地方只需要填写IP和端口即可</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 采集的时候prometheus会加上url路径访问http://localhost:9090/metrics获取数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">static_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">targets</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&#39;localhost:9090&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">job_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;host-node&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">static_configs</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">targets</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&#39;172.17.0.1:9100&#39;</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">global</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 配置全局默认收集metrics间隔</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">scrape_interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">15s</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 当与外部系统通信的时候，会把该配置下的\`label\`信息附加到数据中</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">external_labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">monitor</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;codelab-monitor&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 收集数据的配置</span></span>
<span class="line"><span style="color:#22863A;">scrape_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;"># 定义收集job名称，此处采集prometheus自己本身的metrics</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">job_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;prometheus&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 收集间隔会覆盖上面的全局配置</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">scrape_interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 配置采集的http的接口位置，这个地方只需要填写IP和端口即可</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 采集的时候prometheus会加上url路径访问http://localhost:9090/metrics获取数据</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">static_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">targets</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&#39;localhost:9090&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">job_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;host-node&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">static_configs</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">targets</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&#39;172.17.0.1:9100&#39;</span><span style="color:#24292E;">]</span></span></code></pre></div><p><code>host-node</code>解释</p><ul><li><p>该采集程序是由<code>compose.yaml</code>文件中配置的服务<code>node-exporter</code>提供的，开放9100端口</p></li><li><p>由于其处于<code>host</code>宿主机网络命名空间，而<code>prometheus</code>处于<code>docker</code>内部的一个桥接网络<code>demo</code>网络环境中，所以不能通过<code>127.0.0.1</code>或者<code>node-exporter</code>访问到对应的<code>node-exporter</code>采集程序，所以<code>targets</code>参数需要填写<code>docker0</code>的<code>IP</code>来表示宿主机网络空间下的<code>prometheus</code></p><p><strong>查看<code>docker0</code>的<code>IP</code>如下，一般在<code>linux</code>上安装<code>docker</code>之后，默认<code>docker0</code>网卡的<code>IP</code>是固定的<code>172.17.0.1</code>，其他操作系统或环境可能是别的<code>IP</code>，此处配置需要具体留意，按照实际的<code>IP</code>地址修改</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">addr</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker0</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">14:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker0:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">NO-CARRIER,BROADCAST,MULTICAST,U</span><span style="color:#E1E4E8;">P</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mtu</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1500</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">qdisc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">noqueue</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DOWN</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">group</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">link/ether</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">02</span><span style="color:#9ECBFF;">:42:49:57:88:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.0.1/16</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.255.255</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker0</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">addr</span><span style="color:#24292E;"> </span><span style="color:#032F62;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker0</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">14:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker0:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">NO-CARRIER,BROADCAST,MULTICAST,U</span><span style="color:#24292E;">P</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mtu</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1500</span><span style="color:#24292E;"> </span><span style="color:#032F62;">qdisc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">noqueue</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DOWN</span><span style="color:#24292E;"> </span><span style="color:#032F62;">group</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">link/ether</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">02</span><span style="color:#032F62;">:42:49:57:88:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.0.1/16</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.255.255</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker0</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span></code></pre></div></li></ul><h2 id="服务启动" tabindex="-1">服务启动 <a class="header-anchor" href="#服务启动" aria-label="Permalink to &quot;服务启动&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span></span>
<span class="line"><span style="color:#E1E4E8;">[+] Running 7/7</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.1</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;prom_prometheus-data&quot;</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;prom_grafana-data&quot;</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;prom_grafana-config&quot;</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-grafana</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.5</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-node-exporter</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.2</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">⠿</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-prometheus</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0.4</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span></span>
<span class="line"><span style="color:#24292E;">[+] Running 7/7</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">Created</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.1</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;prom_prometheus-data&quot;</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Created</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;prom_grafana-data&quot;</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Created</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;prom_grafana-config&quot;</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Created</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-grafana</span><span style="color:#24292E;">         </span><span style="color:#032F62;">Started</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.5</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-node-exporter</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Started</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.2</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">⠿</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-prometheus</span><span style="color:#24292E;">      </span><span style="color:#032F62;">Started</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0.4</span><span style="color:#032F62;">s</span></span></code></pre></div><p>检查<code>docker</code>网络命名空间</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ls</span></span>
<span class="line"><span style="color:#B392F0;">NETWORK</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">NAME</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">DRIVER</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">SCOPE</span></span>
<span class="line"><span style="color:#B392F0;">61ff0fdec0df</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">bridge</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">local</span></span>
<span class="line"><span style="color:#B392F0;">0812cab7929c</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">local</span></span>
<span class="line"><span style="color:#79B8FF;">....</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ls</span></span>
<span class="line"><span style="color:#6F42C1;">NETWORK</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID</span><span style="color:#24292E;">     </span><span style="color:#032F62;">NAME</span><span style="color:#24292E;">     </span><span style="color:#032F62;">DRIVER</span><span style="color:#24292E;">    </span><span style="color:#032F62;">SCOPE</span></span>
<span class="line"><span style="color:#6F42C1;">61ff0fdec0df</span><span style="color:#24292E;">   </span><span style="color:#032F62;">demo</span><span style="color:#24292E;">     </span><span style="color:#032F62;">bridge</span><span style="color:#24292E;">    </span><span style="color:#032F62;">local</span></span>
<span class="line"><span style="color:#6F42C1;">0812cab7929c</span><span style="color:#24292E;">   </span><span style="color:#032F62;">host</span><span style="color:#24292E;">     </span><span style="color:#032F62;">host</span><span style="color:#24292E;">      </span><span style="color:#032F62;">local</span></span>
<span class="line"><span style="color:#005CC5;">....</span></span></code></pre></div><p>检查<code>demo</code>网络命名空间里面的容器</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;Name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;demo&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        ....</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;Containers&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;774dd4e703f541872b5ed513996020c4e2239694663df62b50c5c83451938368&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;Name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;demo-grafana&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;EndpointID&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;73c2c67e833446363cdde52b2536d9981ca6b813342638697616bfce42bc1e6f&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;MacAddress&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;02:42:c0:a8:a0:02&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;IPv4Address&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;192.168.160.2/20&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;IPv6Address&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;ed204573a64bc2601f4310cb5dbfe4952ac1c2b310a218ced63b578ff6ef49dc&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;Name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;demo-prometheus&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;EndpointID&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;f8e4f5c42ccfdd2387f9a76392f3e6bbcbba1efe850a8392fdcbf47cafe29a09&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;MacAddress&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;02:42:c0:a8:a0:03&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;IPv4Address&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;192.168.160.3/20&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;IPv6Address&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        ....</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;Name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;demo&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        ....</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;Containers&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;774dd4e703f541872b5ed513996020c4e2239694663df62b50c5c83451938368&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;Name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;demo-grafana&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;EndpointID&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;73c2c67e833446363cdde52b2536d9981ca6b813342638697616bfce42bc1e6f&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;MacAddress&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;02:42:c0:a8:a0:02&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;IPv4Address&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;192.168.160.2/20&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;IPv6Address&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;ed204573a64bc2601f4310cb5dbfe4952ac1c2b310a218ced63b578ff6ef49dc&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;Name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;demo-prometheus&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;EndpointID&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;f8e4f5c42ccfdd2387f9a76392f3e6bbcbba1efe850a8392fdcbf47cafe29a09&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;MacAddress&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;02:42:c0:a8:a0:03&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;IPv4Address&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;192.168.160.3/20&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;IPv6Address&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        ....</span></span>
<span class="line"><span style="color:#24292E;">]</span></span></code></pre></div><p>检查<code>docker host</code>网络命名空间的容器</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;Name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;host&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        ...</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;Containers&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;bde02aced39fd6bfc6017647b05d187d1eb94b5f7155cb026bead1cbc9038d19&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;Name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;demo-node-exporter&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;EndpointID&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;07d90ac1f8ebc897035c0cfde1b54210c85c442ea2125625c4f32090e3e28700&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;MacAddress&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;IPv4Address&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;IPv6Address&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        ...</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span></span>
<span class="line"><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;Name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;host&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        ...</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;Containers&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;bde02aced39fd6bfc6017647b05d187d1eb94b5f7155cb026bead1cbc9038d19&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;Name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;demo-node-exporter&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;EndpointID&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;07d90ac1f8ebc897035c0cfde1b54210c85c442ea2125625c4f32090e3e28700&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;MacAddress&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;IPv4Address&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;IPv6Address&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        ...</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">]</span></span></code></pre></div><h2 id="采集程序服务验证" tabindex="-1">采集程序服务验证 <a class="header-anchor" href="#采集程序服务验证" aria-label="Permalink to &quot;采集程序服务验证&quot;">​</a></h2><ul><li><p><code>prometheus</code>服务自带采集程序，浏览器访问地址<code>http://localhost:9090/metrics</code>查看是否返回数据</p></li><li><p><code>node-exporter</code>开放端口9100，浏览器访问地址<code>http://localhost:9100/metrics</code>查看是否返回数据</p></li></ul><h2 id="grafana增加dasboard" tabindex="-1"><code>grafana</code>增加<code>dasboard</code> <a class="header-anchor" href="#grafana增加dasboard" aria-label="Permalink to &quot;\`grafana\`增加\`dasboard\`&quot;">​</a></h2><p>访问<code>http://localhost:3000/</code>进入到<code>grafana</code>登录页面，输入账号密码<code>admin/admin</code>登录</p><p>导航到<code>Configuration/Data Sources</code>，新增一个<code>data source</code>，点击<code>Add data source</code>按钮之后在弹出的列表当中选择<code>Prometheus</code></p><p><img src="`+l+'" alt="grafana-add-datasource"></p><p>填写基本的名称参数以及<code>Prometheus</code>的地址</p><p>由于<code>grafana</code>以及<code>prometheus</code>都处于<code>docker</code>的<code>demo</code>网络环境中，所以在填写<code>prometheus</code>的<code>IP</code>地址时需要直接填写<code>prometheus</code>进行访问</p><p>填写完成之后点击最下面的<code>Save &amp; test</code>按钮</p><p><img src="'+e+'" alt="grafana-config"></p><p>最后点击<code>Dashboards</code>配置图表，发现有三个默认的图表，直接点击<code>import</code>即可</p><p><img src="'+c+'" alt="grafana-dashboard-default"></p><p>最后保存退出，去访问<code>Dashboards/Browse</code>查看图表</p><p><img src="'+t+'" alt="grafana-dashboards"></p><p>目前由于<code>Grafana metrics</code>没有被包含到<code>prometheus</code>的采集配置<code>yml</code>文件中，所以该图表是没有数据的，现在可以点击<code>Prometheus 2.0 stats</code>查看图表</p><p><img src="'+r+'" alt="grafana-prometheus-2.0"></p><h2 id="grafana增加node-exporter的dashboard" tabindex="-1"><code>grafana</code>增加<code>node exporter</code>的<code>dashboard</code> <a class="header-anchor" href="#grafana增加node-exporter的dashboard" aria-label="Permalink to &quot;`grafana`增加`node exporter`的`dashboard`&quot;">​</a></h2><p>首先去访问<code>grafana</code>的<code>dashborads</code>库<code>https://grafana.com/grafana/dashboards/</code>获取一个<code>node exporter</code>的配置<code>json</code>文件</p><p><img src="'+E+'" alt="grafana-dashboards-db"></p><p><img src="'+y+'" alt="grafana-node-exporter"></p><p>之后回到<code>grafana</code>的页面点击<code>Import</code>按钮，在弹出的新页面中导入下载的<code>json</code>，可以直接上传<code>json</code>或者拖动<code>json</code>文件到页面</p><p><img src="'+d+'" alt="grafana-import-json"></p><p>最后配置选择数据源<code>Prometheus</code>，配置完成之后点击<code>Import</code>按钮</p><p><img src="'+i+'" alt="grafana-node-exporter-config"></p><p>最后<code>Dashboard</code>的列表页面就新增完成了<code>Node Exporter Full</code>的选项，点击进去就看到了<code>node exporter</code>的数据图表</p><p><img src="'+F+'" alt="grafana-node-exporter-dashboard"></p><p>至此，服务启动与基本配置完成</p><h2 id="参考阅读" tabindex="-1">参考阅读 <a class="header-anchor" href="#参考阅读" aria-label="Permalink to &quot;参考阅读&quot;">​</a></h2><p><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noreferrer"><code>prometheus/node_exporter</code>项目仓库<code>readme.md</code></a></p><p><a href="https://prometheus.io/docs/prometheus/latest/getting_started/" target="_blank" rel="noreferrer"><code>Prometheus Getting Started</code>官方文档</a></p><p><a href="https://grafana.com/grafana/dashboards/" target="_blank" rel="noreferrer"><code>grafana</code>图表库</a></p>',54),q=[m];function h(C,g,f,B,b,_){return a(),n("div",null,q)}const k=s(u,[["render",h]]);export{A as __pageData,k as default};
