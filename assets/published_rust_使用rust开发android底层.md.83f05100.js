import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.36bc40e2.js";const h=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"published/rust/使用rust开发android底层.md","filePath":"published/rust/使用rust开发android底层.md","lastUpdated":1693296118000}'),o={name:"published/rust/使用rust开发android底层.md"},p=l(`<p>本文档使用<code>rust</code>开发<code>android</code>程序，只涉及到底层开发，不涉及任何<code>ui</code>相关，开发前推荐安装好<code>magisk</code>框架，方便后面获取手机<code>root</code>权限，或者有别的方案可以使<code>adb</code>获取到<code>root</code>权限也行</p><p>把<code>android</code>看成是一个裁剪了很多模块的<code>linux</code>操作系统，后面的操作与概念就好理解很多了</p><h2 id="linux权限说明" tabindex="-1"><code>linux</code>权限说明 <a class="header-anchor" href="#linux权限说明" aria-label="Permalink to &quot;\`linux\`权限说明&quot;">​</a></h2><ul><li><p><code>root</code>权限，超级权限，可以随心所欲，为所欲为</p></li><li><p>普通权限</p></li></ul><h2 id="android权限说明" tabindex="-1"><code>Android</code>权限说明 <a class="header-anchor" href="#android权限说明" aria-label="Permalink to &quot;\`Android\`权限说明&quot;">​</a></h2><ul><li><p>安全体系结构设计的核心是：默认情况下，任何应用程序都无权执行任何会对其他应用程序、操作系统或用户产生负面影响的操作</p></li><li><p>为了保护<code>Android</code>用户的隐私，避免上述负面影响，<code>Android</code>对权限进行管理：Android应用在需要使用某些功能时必须进行权限的申请，而根据权限的保护级别，系统可能会自动授予权限，或者提示用户批准请求</p></li><li><p><code>Android</code>包装了一套自己的权限体系</p><ul><li><p><code>root</code></p></li><li><p><code>platform</code></p></li><li><p><code>media</code></p></li><li><p><code>shared</code></p></li><li><p>...</p></li></ul></li><li><p><code>root</code>权限是超级权限，该权限可以对系统进行任意操作，这一点与<code>linux</code>相同</p></li><li><p>提供了访问<code>system</code>目录的权限，即<code>system</code>权限，对应<code>Android</code>的权限体系为<code>platform</code></p></li></ul><h2 id="实验设备信息" tabindex="-1">实验设备信息 <a class="header-anchor" href="#实验设备信息" aria-label="Permalink to &quot;实验设备信息&quot;">​</a></h2><p><code>Xiaomi Redmi note 7 Pro</code></p><h2 id="rust项目创建" tabindex="-1"><code>rust</code>项目创建 <a class="header-anchor" href="#rust项目创建" aria-label="Permalink to &quot;\`rust\`项目创建&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cargo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android-agent</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cargo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android-agent</span></span></code></pre></div><p>修改<code>Cargo.toml</code>的依赖信息如下</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">dependencies</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">tokio = { version = </span><span style="color:#9ECBFF;">&quot;1&quot;</span><span style="color:#E1E4E8;">, features = [</span><span style="color:#9ECBFF;">&quot;full&quot;</span><span style="color:#E1E4E8;">]}</span></span>
<span class="line"><span style="color:#E1E4E8;">tracing = </span><span style="color:#9ECBFF;">&quot;0.1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">tracing-subscriber = </span><span style="color:#9ECBFF;">&quot;0.3&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#6F42C1;">dependencies</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">tokio = { version = </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#24292E;">, features = [</span><span style="color:#032F62;">&quot;full&quot;</span><span style="color:#24292E;">]}</span></span>
<span class="line"><span style="color:#24292E;">tracing = </span><span style="color:#032F62;">&quot;0.1&quot;</span></span>
<span class="line"><span style="color:#24292E;">tracing-subscriber = </span><span style="color:#032F62;">&quot;0.3&quot;</span></span></code></pre></div><p>修改<code>main.rs</code></p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#[tokio</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">main]</span></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">fn</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">tracing_subscriber</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">fmt</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">loop</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">tracing</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">info!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Hello world!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">tokio</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">time</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">std</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">time</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Duration</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">from_secs</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">.await</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#[tokio</span><span style="color:#D73A49;">::</span><span style="color:#24292E;">main]</span></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">fn</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">tracing_subscriber</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">fmt</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">loop</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">tracing</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">info!</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Hello world!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">tokio</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">time</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">std</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">time</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">Duration</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">from_secs</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">.await</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>由于本人是在<code>Ubuntu22</code>环境下开发，底层<code>C</code>库与<code>android</code>的库可能有较大差异，所以编译需要依赖一个<code>rust</code>的交叉编译项目<code>cross</code>，工具安装与操作自行查看该项目文档</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">https://github.com/cross-rs/cross</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">https://github.com/cross-rs/cross</span></span></code></pre></div><p>查看<code>rust</code>支持编译的<code>android</code>类型</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rustc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target-list</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android</span></span>
<span class="line"><span style="color:#B392F0;">aarch64-linux-android</span></span>
<span class="line"><span style="color:#B392F0;">arm-linux-androideabi</span></span>
<span class="line"><span style="color:#B392F0;">armv7-linux-androideabi</span></span>
<span class="line"><span style="color:#B392F0;">i686-linux-android</span></span>
<span class="line"><span style="color:#B392F0;">thumbv7neon-linux-androideabi</span></span>
<span class="line"><span style="color:#B392F0;">x86_64-linux-android</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rustc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target-list</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android</span></span>
<span class="line"><span style="color:#6F42C1;">aarch64-linux-android</span></span>
<span class="line"><span style="color:#6F42C1;">arm-linux-androideabi</span></span>
<span class="line"><span style="color:#6F42C1;">armv7-linux-androideabi</span></span>
<span class="line"><span style="color:#6F42C1;">i686-linux-android</span></span>
<span class="line"><span style="color:#6F42C1;">thumbv7neon-linux-androideabi</span></span>
<span class="line"><span style="color:#6F42C1;">x86_64-linux-android</span></span></code></pre></div><p>由于目前测试机是真实的<code>Android</code>手机，<code>Android</code>手机基本都是<code>arm</code>架构的，所以编译<code>target</code>选择<code>aarch64-linux-android</code>，如果是电脑上面的虚拟手机，这些年的非苹果电脑基本都是<code>x86_64</code>架构的，可以选择<code>x86_64-linux-android</code></p><p>使用的包可能比较新，<code>cross</code>工具发行<code>release</code>和当前时间可能存在较大时间差到时某些<code>GLibc</code>版本可能差异较大导致编译报错，所以还需要新建一个文件<code>Cross.toml</code>，配置使用最新的<code>cross</code>编译镜像</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">target</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">aarch64-linux-android</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">image = </span><span style="color:#9ECBFF;">&quot;ghcr.io/cross-rs/aarch64-linux-android:edge&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#6F42C1;">target</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">aarch64-linux-android</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">image = </span><span style="color:#032F62;">&quot;ghcr.io/cross-rs/aarch64-linux-android:edge&quot;</span></span></code></pre></div><p>开始执行编译</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cross</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aarch64-linux-android</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cross</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aarch64-linux-android</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span></span></code></pre></div><p>使用<code>adb</code>把编译生成的文件推送到<code>android</code>手机上，注意，需要推送到<code>/sdcard</code>下面，<code>/sdcard</code>的属主/归属组是<code>root/root</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adb</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">push</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target/aarch64-linux-android/release/android-agent</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sdcard/</span></span>
<span class="line"><span style="color:#B392F0;">target/aarch64-linux-android/release/android-agent:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pushed.</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30.8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB/s</span><span style="color:#E1E4E8;"> (2677824 </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.083</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adb</span><span style="color:#24292E;"> </span><span style="color:#032F62;">push</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target/aarch64-linux-android/release/android-agent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sdcard/</span></span>
<span class="line"><span style="color:#6F42C1;">target/aarch64-linux-android/release/android-agent:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pushed.</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30.8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB/s</span><span style="color:#24292E;"> (2677824 </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.083</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)</span></span></code></pre></div><p>进入<code>android</code>手机<code>shell</code>环境</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adb</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shell</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adb</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shell</span></span></code></pre></div><p><code>adb</code>获取<code>root</code>权限，该操作是安装了<code>Magisk</code>之后才可以这样获取</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">su</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">su</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#</span></span></code></pre></div><p>执行<code>chmod</code>赋予执行权限，之后筛选查看权限发现并没有成功赋予权限</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># chmod a+x /sdcard/android-agent </span></span>
<span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ls -l /sdcard/ |grep android                                                                                           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-rw-rw----</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sdcard_rw</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2677824</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2023</span><span style="color:#9ECBFF;">-04-14</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android-agent</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># chmod a+x /sdcard/android-agent </span></span>
<span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ls -l /sdcard/ |grep android                                                                                           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-rw-rw----</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sdcard_rw</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2677824</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2023</span><span style="color:#032F62;">-04-14</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android-agent</span></span></code></pre></div><p>这个时候需要把文件复制到<code>/data</code>下面，再赋予执行权限，如果一开始就使用<code>adb push</code>执行文件到<code>/data</code>下面会报错<code>Permission denied</code>，<code>/data</code>的属主/归属组是<code>system/system</code>，该文件夹可能不能直接推送文件进入</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># mv /sdcard/android-agent /data/</span></span>
<span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># chmod a+x /data/android-agent</span></span>
<span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ls -l /data/ |grep android                                                                                             </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-rwxrwx--x</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">sdcard_rw</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2677824</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2023</span><span style="color:#9ECBFF;">-04-14</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android-agent</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># mv /sdcard/android-agent /data/</span></span>
<span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># chmod a+x /data/android-agent</span></span>
<span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ls -l /data/ |grep android                                                                                             </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-rwxrwx--x</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">     </span><span style="color:#032F62;">sdcard_rw</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2677824</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2023</span><span style="color:#032F62;">-04-14</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android-agent</span></span></code></pre></div><p>之后验证执行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ./data/android-agent                                                                                                       </span></span>
<span class="line"><span style="color:#B392F0;">2023-04-14T09:15:53.752045Z</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android_agent:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world!</span></span>
<span class="line"><span style="color:#B392F0;">2023-04-14T09:15:54.753759Z</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android_agent:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world!</span></span>
<span class="line"><span style="color:#B392F0;">2023-04-14T09:15:55.756782Z</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android_agent:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world!</span></span>
<span class="line"><span style="color:#B392F0;">2023-04-14T09:15:56.759287Z</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android_agent:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world!</span></span>
<span class="line"><span style="color:#B392F0;">2023-04-14T09:15:57.762281Z</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">INFO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android_agent:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ./data/android-agent                                                                                                       </span></span>
<span class="line"><span style="color:#6F42C1;">2023-04-14T09:15:53.752045Z</span><span style="color:#24292E;">  </span><span style="color:#032F62;">INFO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android_agent:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world!</span></span>
<span class="line"><span style="color:#6F42C1;">2023-04-14T09:15:54.753759Z</span><span style="color:#24292E;">  </span><span style="color:#032F62;">INFO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android_agent:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world!</span></span>
<span class="line"><span style="color:#6F42C1;">2023-04-14T09:15:55.756782Z</span><span style="color:#24292E;">  </span><span style="color:#032F62;">INFO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android_agent:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world!</span></span>
<span class="line"><span style="color:#6F42C1;">2023-04-14T09:15:56.759287Z</span><span style="color:#24292E;">  </span><span style="color:#032F62;">INFO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android_agent:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world!</span></span>
<span class="line"><span style="color:#6F42C1;">2023-04-14T09:15:57.762281Z</span><span style="color:#24292E;">  </span><span style="color:#032F62;">INFO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android_agent:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world!</span></span></code></pre></div><h2 id="android-shell扩展了解" tabindex="-1"><code>Android shell</code>扩展了解 <a class="header-anchor" href="#android-shell扩展了解" aria-label="Permalink to &quot;\`Android shell\`扩展了解&quot;">​</a></h2><p><code>android</code>还是包含了很多工具的，比如<code>ping</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ping baidu.com</span></span>
<span class="line"><span style="color:#B392F0;">PING</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">baidu.com</span><span style="color:#E1E4E8;"> (110.242.68.66) 56(</span><span style="color:#B392F0;">84</span><span style="color:#E1E4E8;">) bytes of data.</span></span>
<span class="line"><span style="color:#B392F0;">64</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">110.242</span><span style="color:#9ECBFF;">.68.66:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">icmp_seq=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ttl=</span><span style="color:#79B8FF;">64</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time=</span><span style="color:#79B8FF;">0.430</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ms</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ping baidu.com</span></span>
<span class="line"><span style="color:#6F42C1;">PING</span><span style="color:#24292E;"> </span><span style="color:#032F62;">baidu.com</span><span style="color:#24292E;"> (110.242.68.66) 56(</span><span style="color:#6F42C1;">84</span><span style="color:#24292E;">) bytes of data.</span></span>
<span class="line"><span style="color:#6F42C1;">64</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">110.242</span><span style="color:#032F62;">.68.66:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">icmp_seq=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ttl=</span><span style="color:#005CC5;">64</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time=</span><span style="color:#005CC5;">0.430</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ms</span></span></code></pre></div><p>比如<code>curl</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># curl https://baidu.com                                                                                                     </span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">html</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">head&gt;&lt;title</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">302 Found</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/title&gt;&lt;/head</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">body bgcolor=</span><span style="color:#9ECBFF;">&quot;white&quot;</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">center&gt;&lt;h</span><span style="color:#F97583;">1&gt;</span><span style="color:#E1E4E8;">302 Found</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/h1&gt;&lt;/center</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">hr&gt;&lt;center</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">bfe/1.0.8.</span><span style="color:#F97583;">18&lt;</span><span style="color:#E1E4E8;">/center</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/html</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># curl https://baidu.com                                                                                                     </span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">html</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">head&gt;&lt;title</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">302 Found</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/title&gt;&lt;/head</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">body bgcolor=</span><span style="color:#032F62;">&quot;white&quot;</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">center&gt;&lt;h</span><span style="color:#D73A49;">1&gt;</span><span style="color:#24292E;">302 Found</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/h1&gt;&lt;/center</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">hr&gt;&lt;center</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">bfe/1.0.8.</span><span style="color:#D73A49;">18&lt;</span><span style="color:#24292E;">/center</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/body</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/html</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>查看内核信息</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">violet:/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># cat /proc/version                                                                                                          </span></span>
<span class="line"><span style="color:#B392F0;">Linux</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4.14</span><span style="color:#9ECBFF;">.117-perf-g288905b</span><span style="color:#E1E4E8;"> (builder@c4-miui-ota-bd188.bj) (</span><span style="color:#B392F0;">clang</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8.0</span><span style="color:#9ECBFF;">.11</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Android</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NDK</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">#1 SMP PREEMPT Mon Nov 8 19:38:11 CST 2021</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">violet:/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># cat /proc/version                                                                                                          </span></span>
<span class="line"><span style="color:#6F42C1;">Linux</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.14</span><span style="color:#032F62;">.117-perf-g288905b</span><span style="color:#24292E;"> (builder@c4-miui-ota-bd188.bj) (</span><span style="color:#6F42C1;">clang</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8.0</span><span style="color:#032F62;">.11</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Android</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NDK</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">#1 SMP PREEMPT Mon Nov 8 19:38:11 CST 2021</span></span></code></pre></div><p>非<code>root</code>的<code>shell</code>权限可以读写的地址</p><p>该地址可以使用<code>adb</code>连接上去之后，直接<code>cd</code>到该路径，并可以在该路径下创建文件，可以赋予可执行权限并执行</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/data/local/tmp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/data/local/tmp</span></span></code></pre></div><h2 id="参考阅读" tabindex="-1">参考阅读 <a class="header-anchor" href="#参考阅读" aria-label="Permalink to &quot;参考阅读&quot;">​</a></h2><p><a href="https://blog.csdn.net/weixin_39251617/article/details/90721030" target="_blank" rel="noreferrer">Android 权限管理</a></p>`,47),e=[p];function c(t,r,y,d,i,E){return a(),n("div",null,e)}const u=s(o,[["render",c]]);export{h as __pageData,u as default};
