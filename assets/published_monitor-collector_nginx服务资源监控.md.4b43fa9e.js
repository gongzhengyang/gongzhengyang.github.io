import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.ec8f7e8e.js";const g=JSON.parse('{"title":"依赖","description":"","frontmatter":{},"headers":[],"relativePath":"published/monitor-collector/nginx服务资源监控.md","filePath":"published/monitor-collector/nginx服务资源监控.md"}'),o={name:"published/monitor-collector/nginx服务资源监控.md"},p=l(`<h1 id="依赖" tabindex="-1">依赖 <a class="header-anchor" href="#依赖" aria-label="Permalink to &quot;依赖&quot;">​</a></h1><p>一个内置的<code>with-http_stub_status_module</code>模块</p><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h2><p>启用的时候只需要配置<code>server</code>块当中加上一小段访问<code>url</code>即可获取到</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location /status {</span></span>
<span class="line"><span style="color:#e1e4e8;">	stub_status on; </span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location /status {</span></span>
<span class="line"><span style="color:#24292e;">	stub_status on; </span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h2 id="docker实现" tabindex="-1"><code>docker</code>实现 <a class="header-anchor" href="#docker实现" aria-label="Permalink to &quot;\`docker\`实现&quot;">​</a></h2><p>目前采用<code>nginx:alpine</code>作为镜像，实现访问<code>http://127.0.0.1/status</code>获取到服务状态信息</p><p>由于需要修改<code>/etc/nginx/conf.d/default.conf</code>文件，所以我们可以选择挂载一个文件或者重新构建一个镜像</p><p>下面我们创建一个<code>Dockerfile</code>，该文件主要是在<code>default.conf</code>文件使用<code>sed</code>查找<code>server_name localhost;</code>并且在后面加入一段<code>location</code></p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> nginx:alpine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">RUN</span><span style="color:#E1E4E8;"> sed -i </span><span style="color:#9ECBFF;">&#39;/server_name  localhost;/a</span><span style="color:#79B8FF;">\\ </span><span style="color:#9ECBFF;">   location /status {</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">        stub_status on;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">    }&#39;</span><span style="color:#E1E4E8;"> /etc/nginx/conf.d/default.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> nginx:alpine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">RUN</span><span style="color:#24292E;"> sed -i </span><span style="color:#032F62;">&#39;/server_name  localhost;/a</span><span style="color:#005CC5;">\\ </span><span style="color:#032F62;">   location /status {</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">        stub_status on;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">    }&#39;</span><span style="color:#24292E;"> /etc/nginx/conf.d/default.conf</span></span></code></pre></div><p>创建<code>compose.yaml</code>文件如下</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nginx</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">build</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">always</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;80:80&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">services</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nginx</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">build</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart</span><span style="color:#24292E;">: </span><span style="color:#032F62;">always</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;80:80&quot;</span></span></code></pre></div><p>开始构建镜像</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span></span></code></pre></div><p>启动容器</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span></span></code></pre></div><p>查看容器内部<code>nginx</code>配置确认<code>location /status</code>块存在</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="color:#B392F0;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">listen</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">server_name</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">localhost</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">stub_status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#access_log  /var/log/nginx/host.access.log  main;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">root</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">/usr/share/nginx/html</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">index</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">index.html</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">index.htm</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#79B8FF;">....</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="color:#6F42C1;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">listen</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">server_name</span><span style="color:#24292E;">  </span><span style="color:#032F62;">localhost</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">stub_status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#access_log  /var/log/nginx/host.access.log  main;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">root</span><span style="color:#24292E;">   </span><span style="color:#032F62;">/usr/share/nginx/html</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">index</span><span style="color:#24292E;">  </span><span style="color:#032F62;">index.html</span><span style="color:#24292E;"> </span><span style="color:#032F62;">index.htm</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#005CC5;">....</span></span></code></pre></div><h2 id="结果验证" tabindex="-1">结果验证 <a class="header-anchor" href="#结果验证" aria-label="Permalink to &quot;结果验证&quot;">​</a></h2><p>浏览器访问地址<code>http://127.0.0.1/status</code>获取返回数据如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">Active connections: 2 </span></span>
<span class="line"><span style="color:#e1e4e8;">server accepts handled requests</span></span>
<span class="line"><span style="color:#e1e4e8;"> 2 2 4 </span></span>
<span class="line"><span style="color:#e1e4e8;">Reading: 0 Writing: 1 Waiting: 1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Active connections: 2 </span></span>
<span class="line"><span style="color:#24292e;">server accepts handled requests</span></span>
<span class="line"><span style="color:#24292e;"> 2 2 4 </span></span>
<span class="line"><span style="color:#24292e;">Reading: 0 Writing: 1 Waiting: 1</span></span></code></pre></div><p>字段含义</p><ul><li><code>Active connections</code>: 活跃连接数</li><li><code>server</code><ul><li><code>accepts</code>: 接收请求</li><li><code>handled</code>: 已处理请求</li><li><code>requests</code>: 客户端请求</li></ul></li><li><code>Reading</code>: 当前所有连接中正在读取请求<code>Header</code>的数量</li><li><code>Writing</code>: 当前所有连接中正在返回数据的数量</li><li><code>Waiting</code>: 当前等待请求的空闲客户端连接数</li></ul><h2 id="配置syslog" tabindex="-1">配置<code>syslog</code> <a class="header-anchor" href="#配置syslog" aria-label="Permalink to &quot;配置\`syslog\`&quot;">​</a></h2><p><code>nginx</code>支持把日志<code>access_log/error_log</code>通过<code>syslog</code>的方式发送出去</p><p>首先需要确保机器有<code>syslog</code>服务</p><p>可以通过执行命令查看</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rsyslog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rsyslog</span></span></code></pre></div><p>查看<code>docker0</code>网口的<code>IP</code>，该<code>IP</code>会作为容器内部访问宿主机的<code>IP</code>，在<code>linux</code>系统中，该<code>IP</code>一般会是<code>172.17.0.1</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">addr</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker0</span></span>
<span class="line"><span style="color:#B392F0;">15:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker0:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">NO-CARRIER,BROADCAST,MULTICAST,U</span><span style="color:#E1E4E8;">P</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mtu</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1500</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">qdisc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">noqueue</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DOWN</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">group</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">link/ether</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">02</span><span style="color:#9ECBFF;">:42:81:36:cb:3c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.0.1/16</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.255.255</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker0</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">inet6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">fe80::42:81ff:fe36:cb3c/64</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">link</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">addr</span><span style="color:#24292E;"> </span><span style="color:#032F62;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker0</span></span>
<span class="line"><span style="color:#6F42C1;">15:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker0:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">NO-CARRIER,BROADCAST,MULTICAST,U</span><span style="color:#24292E;">P</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mtu</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1500</span><span style="color:#24292E;"> </span><span style="color:#032F62;">qdisc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">noqueue</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DOWN</span><span style="color:#24292E;"> </span><span style="color:#032F62;">group</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">link/ether</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">02</span><span style="color:#032F62;">:42:81:36:cb:3c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.0.1/16</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.255.255</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker0</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">inet6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">fe80::42:81ff:fe36:cb3c/64</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">link</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span></code></pre></div><p>通过修改<code>/etc/nginx/nginx.conf</code>文件的方式配置远程<code>syslog</code>服务的地址，由于<code>nginx</code>目前处于容器中，所以填上<code>docker0</code>的<code>IP</code>表示把<code>syslog</code>日志发送到宿主机的<code>syslog</code>服务</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">http {</span></span>
<span class="line"><span style="color:#e1e4e8;">	...</span></span>
<span class="line"><span style="color:#e1e4e8;">	access_log  /var/log/nginx/access.log  main;</span></span>
<span class="line"><span style="color:#e1e4e8;">    access_log syslog:server=172.17.0.1:514,tag=nginx_access_log;</span></span>
<span class="line"><span style="color:#e1e4e8;">    error_log syslog:server=172.17.0.1:514,tag=nginx_error_log;</span></span>
<span class="line"><span style="color:#e1e4e8;">    ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">http {</span></span>
<span class="line"><span style="color:#24292e;">	...</span></span>
<span class="line"><span style="color:#24292e;">	access_log  /var/log/nginx/access.log  main;</span></span>
<span class="line"><span style="color:#24292e;">    access_log syslog:server=172.17.0.1:514,tag=nginx_access_log;</span></span>
<span class="line"><span style="color:#24292e;">    error_log syslog:server=172.17.0.1:514,tag=nginx_error_log;</span></span>
<span class="line"><span style="color:#24292e;">    ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>之后在容器启动之后，在终端输入命令查看<code>syslog</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tail</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/log/syslog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tail</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/log/syslog</span></span></code></pre></div><p>打开浏览器访问<code>nginx</code>的服务，就可以在上面终端看到访问日志了</p><h2 id="参考阅读" tabindex="-1">参考阅读 <a class="header-anchor" href="#参考阅读" aria-label="Permalink to &quot;参考阅读&quot;">​</a></h2><p><a href="http://nginx.org/en/docs/http/ngx_http_stub_status_module.html" target="_blank" rel="noreferrer"><code>Module ngx_http_stub_status_module</code></a></p><p><a href="http://nginx.org/en/docs/syslog.html" target="_blank" rel="noreferrer"><code>nginx syslog mod</code></a></p>`,38),e=[p];function c(t,r,y,E,i,d){return a(),n("div",null,e)}const h=s(o,[["render",c]]);export{g as __pageData,h as default};
