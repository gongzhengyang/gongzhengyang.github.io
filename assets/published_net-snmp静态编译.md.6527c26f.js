import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.ec8f7e8e.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"published/net-snmp静态编译.md","filePath":"published/net-snmp静态编译.md"}'),p={name:"published/net-snmp静态编译.md"},o=l(`<p>由于在某些场景需要使用静态链接的<code>snmpwalk</code>或者其他程序，为了方便执行文件的分发，适配多版本系统，所以需要自己编译<code>net-snmp</code></p><p>实验操作系统<code>Ubuntu22 amd64</code></p><h2 id="获取程序" tabindex="-1">获取程序 <a class="header-anchor" href="#获取程序" aria-label="Permalink to &quot;获取程序&quot;">​</a></h2><p><code>git clone</code>方式</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clone</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/net-snmp/net-snmp.git</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clone</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/net-snmp/net-snmp.git</span></span></code></pre></div><p>或者也可以依据<code>tag</code>下载源码包</p><h2 id="生成makefile" tabindex="-1">生成<code>Makefile</code> <a class="header-anchor" href="#生成makefile" aria-label="Permalink to &quot;生成\`Makefile\`&quot;">​</a></h2><p><code>net-snmp</code>项目根路径下面有一个<code>configure</code>文件，可以用于生成<code>Makefile</code>，命令执行过程中会弹出一些输入确认，直接回车确认即可</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./configure</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--prefix=/tmp/snmp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--disable-embedded-perl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--without-perl-modules</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--disable-ucd-snmp-compatibility</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--disable-scripts</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./configure</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--prefix=/tmp/snmp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--disable-embedded-perl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--without-perl-modules</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--disable-ucd-snmp-compatibility</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--disable-scripts</span></span></code></pre></div><p><code>--prefix</code>参数指定文件安装目录到<code>/tmp/snmp</code></p><p>需要禁用<code>perl</code>相关模块以及一些脚本，否则可能会遇到错误如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">relocation R_X86_64_PC32 against symbol \`netsnmp_ds_handle_config&#39; can not be used when making a shared object; recompile with -fPIC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">relocation R_X86_64_PC32 against symbol \`netsnmp_ds_handle_config&#39; can not be used when making a shared object; recompile with -fPIC</span></span></code></pre></div><h2 id="生成执行程序" tabindex="-1">生成执行程序 <a class="header-anchor" href="#生成执行程序" aria-label="Permalink to &quot;生成执行程序&quot;">​</a></h2><p>如果此时项目根目录下面生成一个<code>Makefile</code>，则表示<code>configure</code>命令成功</p><p>执行程序的源码和生成的二进制都在<code>apps/</code>目录下</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LDFLAGS=&quot;-static&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LDFLAGS=&quot;-static&quot;</span></span></code></pre></div><p>校验生成的二进制执行文件，发现不是静态链接的</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ldd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apps/snmpwalk</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">linux-vdso.so.1</span><span style="color:#E1E4E8;"> (0x00007ffed71c1000)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">libcrypto.so.3</span><span style="color:#E1E4E8;"> =</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/lib/x86_64-linux-gnu/libcrypto.so.3</span><span style="color:#E1E4E8;"> (0x00007ff639800000)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">libc.so.6</span><span style="color:#E1E4E8;"> =</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/lib/x86_64-linux-gnu/libc.so.6</span><span style="color:#E1E4E8;"> (0x00007ff639400000)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">/lib64/ld-linux-x86-64.so.2</span><span style="color:#E1E4E8;"> (0x00007ff639d7e000)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ldd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apps/snmpwalk</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">linux-vdso.so.1</span><span style="color:#24292E;"> (0x00007ffed71c1000)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">libcrypto.so.3</span><span style="color:#24292E;"> =</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/lib/x86_64-linux-gnu/libcrypto.so.3</span><span style="color:#24292E;"> (0x00007ff639800000)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">libc.so.6</span><span style="color:#24292E;"> =</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/lib/x86_64-linux-gnu/libc.so.6</span><span style="color:#24292E;"> (0x00007ff639400000)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">/lib64/ld-linux-x86-64.so.2</span><span style="color:#24292E;"> (0x00007ff639d7e000)</span></span></code></pre></div><h2 id="静态编译snmpwalk" tabindex="-1">静态编译<code>snmpwalk</code> <a class="header-anchor" href="#静态编译snmpwalk" aria-label="Permalink to &quot;静态编译\`snmpwalk\`&quot;">​</a></h2><p>发现在<code>make snmpwalk</code>执行的时候会产生两条执行命令，第一条是 <code>gcc</code>包含<code>-static</code>参数，但是第二条没包含</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apps</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span></span>
<span class="line"><span style="color:#B392F0;">/bin/bash</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../libtool</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--mode=link</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gcc</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-static</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-DNETSNMP_ENABLE_IPV6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-fno-strict-aliasing</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-DNETSNMP_REMOVE_U64</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Ulinux</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dlinux=linux</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-Wall</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wextra</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wstrict-prototypes</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wwrite-strings</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wcast-qual</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wimplicit-fallthrough</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wlogical-op</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wundef</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-format-truncation</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-missing-field-initializers</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-sign-compare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-unused-parameter</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk.lo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../snmplib/libnetsnmp.la</span><span style="color:#E1E4E8;">   </span></span>
<span class="line"><span style="color:#B392F0;">libtool:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">link:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gcc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-DNETSNMP_ENABLE_IPV6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-fno-strict-aliasing</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-DNETSNMP_REMOVE_U64</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Ulinux</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dlinux=linux</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wall</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wextra</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wstrict-prototypes</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wwrite-strings</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wcast-qual</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wimplicit-fallthrough</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wlogical-op</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wundef</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-format-truncation</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-missing-field-initializers</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-sign-compare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-unused-parameter</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.libs/snmpwalk.o</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">../snmplib/.libs/libnetsnmp.a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-lm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-lssl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-lcrypto</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apps</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span></span>
<span class="line"><span style="color:#6F42C1;">/bin/bash</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../libtool</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--mode=link</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gcc</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-static</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-DNETSNMP_ENABLE_IPV6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-fno-strict-aliasing</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-DNETSNMP_REMOVE_U64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Ulinux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dlinux=linux</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-Wall</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wextra</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wstrict-prototypes</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wwrite-strings</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wcast-qual</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wimplicit-fallthrough</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wlogical-op</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wundef</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-format-truncation</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-missing-field-initializers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-sign-compare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-unused-parameter</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk.lo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../snmplib/libnetsnmp.la</span><span style="color:#24292E;">   </span></span>
<span class="line"><span style="color:#6F42C1;">libtool:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">link:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gcc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-DNETSNMP_ENABLE_IPV6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-fno-strict-aliasing</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-DNETSNMP_REMOVE_U64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Ulinux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dlinux=linux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wall</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wextra</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wstrict-prototypes</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wwrite-strings</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wcast-qual</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wimplicit-fallthrough</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wlogical-op</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wundef</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-format-truncation</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-missing-field-initializers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-sign-compare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-unused-parameter</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.libs/snmpwalk.o</span><span style="color:#24292E;">  </span><span style="color:#032F62;">../snmplib/.libs/libnetsnmp.a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-lm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-lssl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-lcrypto</span></span></code></pre></div><p>所以需要执行命令如下，把<code>make snmpwalk</code>的输出的第二条命令粘贴下来，手动在<code>gcc</code>后面加上<code>-static</code>参数</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gcc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-static</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-DNETSNMP_ENABLE_IPV6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-fno-strict-aliasing</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-DNETSNMP_REMOVE_U64</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Ulinux</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dlinux=linux</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wall</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wextra</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wstrict-prototypes</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wwrite-strings</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wcast-qual</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wimplicit-fallthrough</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wlogical-op</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wundef</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-format-truncation</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-missing-field-initializers</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-sign-compare</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Wno-unused-parameter</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.libs/snmpwalk.o</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">../snmplib/.libs/libnetsnmp.a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-lm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-lssl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-lcrypto</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 执行的时候会产生告警信息如下，这是正常的</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/libcrypto.a</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">libcrypto-lib-dso_dlfcn.o</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">dlfcn_globallookup&#39;:</span></span>
<span class="line"><span style="color:#B392F0;">(.text+0x17): 警告： Using &#39;dlopen&#39; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld: ../snmplib/.libs/libnetsnmp.a(system.o): in function \`netsnmp_str_to_gid&#39;</span><span style="color:#79B8FF;">:</span></span>
<span class="line"><span style="color:#B392F0;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:1492:</span><span style="color:#9ECBFF;"> 警告： Using &#39;getgrnam&#39; in statically linked applications requires at runtime the shared libraries from the bc version used for linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld:</span><span style="color:#9ECBFF;"> /home/gong/rust-work/github/net-snmp/snmplib/system.c:1494: 警告： Using &#39;endgrent&#39; in statically linked applications requires at runtime the shared librar from the glibc version used for linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld:</span><span style="color:#9ECBFF;"> ../snmplib/.libs/libnetsnmp.a(</span><span style="color:#B392F0;">system.o</span><span style="color:#9ECBFF;">): in function \`</span><span style="color:#B392F0;">netsnmp_str_to_uid</span><span style="color:#B392F0;">&#39;:</span></span>
<span class="line"><span style="color:#B392F0;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:1459: 警告： Using &#39;</span><span style="color:#B392F0;">getpwnam</span><span style="color:#B392F0;">&#39; in statically linked applications requires at runtime the shared libraries from the bc version used for linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld: /home/gong/rust-work/github/net-snmp/snmplib/system.c:1461: 警告： Using &#39;</span><span style="color:#B392F0;">endpwent</span><span style="color:#B392F0;">&#39; in statically linked applications requires at runtime the shared librar from the glibc version used for linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld: ../snmplib/.libs/libnetsnmp.a(system.o): in function \`netsnmp_getaddrinfo&#39;</span><span style="color:#79B8FF;">:</span></span>
<span class="line"><span style="color:#B392F0;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:884:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">警告：</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;getaddrinfo&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">statically</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">linked</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">applications</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">requires</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runtime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shared</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libraries</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">glibc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">used</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../snmplib/.libs/libnetsnmp.a</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">system.o</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">netsnmp_gethostbyaddr&#39;:</span></span>
<span class="line"><span style="color:#B392F0;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:1050: 警告： Using &#39;gethostbyaddr&#39; in statically linked applications requires at runtime the shared libraries frome glibc version used for linking</span></span>
<span class="line"><span style="color:#B392F0;">/usr/bin/ld: ../snmplib/.libs/libnetsnmp.a(system.o): in function \`netsnmp_gethostbyname&#39;</span><span style="color:#79B8FF;">:</span></span>
<span class="line"><span style="color:#B392F0;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:980:</span><span style="color:#9ECBFF;"> 警告： Using &#39;gethostbyname&#39; in statically linked applications requires at runtime the shared libraries from  glibc version used for linking</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gcc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-static</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-DNETSNMP_ENABLE_IPV6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-fno-strict-aliasing</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-DNETSNMP_REMOVE_U64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Ulinux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dlinux=linux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wall</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wextra</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wstrict-prototypes</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wwrite-strings</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wcast-qual</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wimplicit-fallthrough</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wlogical-op</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wundef</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-format-truncation</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-missing-field-initializers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-sign-compare</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Wno-unused-parameter</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.libs/snmpwalk.o</span><span style="color:#24292E;">  </span><span style="color:#032F62;">../snmplib/.libs/libnetsnmp.a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-lm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-lssl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-lcrypto</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 执行的时候会产生告警信息如下，这是正常的</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/libcrypto.a</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">libcrypto-lib-dso_dlfcn.o</span><span style="color:#24292E;">)</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">function</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">dlfcn_globallookup&#39;:</span></span>
<span class="line"><span style="color:#6F42C1;">(.text+0x17): 警告： Using &#39;dlopen&#39; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld: ../snmplib/.libs/libnetsnmp.a(system.o): in function \`netsnmp_str_to_gid&#39;</span><span style="color:#005CC5;">:</span></span>
<span class="line"><span style="color:#6F42C1;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:1492:</span><span style="color:#032F62;"> 警告： Using &#39;getgrnam&#39; in statically linked applications requires at runtime the shared libraries from the bc version used for linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld:</span><span style="color:#032F62;"> /home/gong/rust-work/github/net-snmp/snmplib/system.c:1494: 警告： Using &#39;endgrent&#39; in statically linked applications requires at runtime the shared librar from the glibc version used for linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld:</span><span style="color:#032F62;"> ../snmplib/.libs/libnetsnmp.a(</span><span style="color:#6F42C1;">system.o</span><span style="color:#032F62;">): in function \`</span><span style="color:#6F42C1;">netsnmp_str_to_uid</span><span style="color:#6F42C1;">&#39;:</span></span>
<span class="line"><span style="color:#6F42C1;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:1459: 警告： Using &#39;</span><span style="color:#6F42C1;">getpwnam</span><span style="color:#6F42C1;">&#39; in statically linked applications requires at runtime the shared libraries from the bc version used for linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld: /home/gong/rust-work/github/net-snmp/snmplib/system.c:1461: 警告： Using &#39;</span><span style="color:#6F42C1;">endpwent</span><span style="color:#6F42C1;">&#39; in statically linked applications requires at runtime the shared librar from the glibc version used for linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld: ../snmplib/.libs/libnetsnmp.a(system.o): in function \`netsnmp_getaddrinfo&#39;</span><span style="color:#005CC5;">:</span></span>
<span class="line"><span style="color:#6F42C1;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:884:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">警告：</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;getaddrinfo&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">statically</span><span style="color:#24292E;"> </span><span style="color:#032F62;">linked</span><span style="color:#24292E;"> </span><span style="color:#032F62;">applications</span><span style="color:#24292E;"> </span><span style="color:#032F62;">requires</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runtime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shared</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libraries</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">glibc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">used</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../snmplib/.libs/libnetsnmp.a</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">system.o</span><span style="color:#24292E;">)</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">function</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">netsnmp_gethostbyaddr&#39;:</span></span>
<span class="line"><span style="color:#6F42C1;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:1050: 警告： Using &#39;gethostbyaddr&#39; in statically linked applications requires at runtime the shared libraries frome glibc version used for linking</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/bin/ld: ../snmplib/.libs/libnetsnmp.a(system.o): in function \`netsnmp_gethostbyname&#39;</span><span style="color:#005CC5;">:</span></span>
<span class="line"><span style="color:#6F42C1;">/home/gong/rust-work/github/net-snmp/snmplib/system.c:980:</span><span style="color:#032F62;"> 警告： Using &#39;gethostbyname&#39; in statically linked applications requires at runtime the shared libraries from  glibc version used for linking</span></span></code></pre></div><p>检查<code>snmpwalk</code>链接</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ldd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">snmpwalk</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">不是动态可执行文件</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ldd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">snmpwalk</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">不是动态可执行文件</span></span></code></pre></div><p>之后也可以把生成的<code>snmpwalk</code>复制到另外一台古老的<code>linux</code>上运行校验，如果机器上有<code>docker</code>， 可以执行命令<code>docker run -it alpine sh</code>，把<code>snmpwalk</code>复制到容器内部执行</p><h2 id="静态链接snmptrapd" tabindex="-1">静态链接<code>snmptrapd</code> <a class="header-anchor" href="#静态链接snmptrapd" aria-label="Permalink to &quot;静态链接\`snmptrapd\`&quot;">​</a></h2><p>如果出现报错如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/usr/bin/ld: 找不到 -lpci: 没有那个文件或目录</span></span>
<span class="line"><span style="color:#e1e4e8;">collect2: error: ld returned 1 exit status</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/usr/bin/ld: 找不到 -lpci: 没有那个文件或目录</span></span>
<span class="line"><span style="color:#24292e;">collect2: error: ld returned 1 exit status</span></span></code></pre></div><p>这个是加入了<code>-static</code>参数导致的</p><p>尝试了</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ sudo apt install libpci-dev</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ sudo apt install libpci-dev</span></span></code></pre></div><p>可以选择把编译选项中<code>-lpci</code>参数去掉</p>`,33),e=[o];function t(c,r,i,y,E,F){return n(),a("div",null,e)}const m=s(p,[["render",t]]);export{C as __pageData,m as default};
