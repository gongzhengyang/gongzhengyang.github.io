import{_ as s,o as a,c as e,Q as n}from"./chunks/framework.36bc40e2.js";const E=JSON.parse('{"title":"背景","description":"","frontmatter":{},"headers":[],"relativePath":"published/libreoffice使用命令行更新目录.md","filePath":"published/libreoffice使用命令行更新目录.md","lastUpdated":1700106669000}'),o={name:"published/libreoffice使用命令行更新目录.md"},p=n(`<h1 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h1><p>有些时候在使用程序编辑了<code>word</code>文件之后，会造成页码的变更，但是在保存的时候，程序不会自动更新页码</p><h2 id="实现方式" tabindex="-1">实现方式 <a class="header-anchor" href="#实现方式" aria-label="Permalink to &quot;实现方式&quot;">​</a></h2><p>任选一种</p><ul><li>在调用<code>libreoffice</code>的时候，编写并指定一个<code>xba</code>文件宏，文件会被打开并更新完成目录之后保存</li><li>依赖项目<code>unoconv/unoserver</code>，调用<code>python</code>开发的执行程序进行文件更新</li></ul><h2 id="xba宏实现" tabindex="-1"><code>xba</code>宏实现 <a class="header-anchor" href="#xba宏实现" aria-label="Permalink to &quot;\`xba\`宏实现&quot;">​</a></h2><p>使用<code>libreoffice</code>程序，通过编辑宏的方式，命令行调用<code>libreoffice</code>程序更新目录</p><p>找到<code>Module1.xba</code>宏的位置，该宏是<code>libreoffice</code>的一个默认宏，需要对该文件新增一点函数</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">find</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Module1.xba&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">2&gt;</span><span style="color:#9ECBFF;">/dev/null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Standard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">find</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Module1.xba&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">2&gt;</span><span style="color:#032F62;">/dev/null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Standard</span></span></code></pre></div><p>一般该文件的位置是</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">~/.config/libreoffice/4/user/basic/Standard/Module1.xba</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">~/.config/libreoffice/4/user/basic/Standard/Module1.xba</span></span></code></pre></div><p>查看该文件的内容</p><div class="language-basic vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">basic</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;!DOCTYPE script:module PUBLIC &quot;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&quot; &quot;module.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;script:module xmlns:script=&quot;http://openoffice.org/2000/script&quot; script:name=&quot;Module1&quot; script:language=&quot;StarBasic&quot;&gt;Sub AutoOpen()</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos;</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos; AutoOpen Macro</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos;</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos;</span></span>
<span class="line"><span style="color:#e1e4e8;">    &amp;apos; Update the entire first table of contents.</span></span>
<span class="line"><span style="color:#e1e4e8;">    &amp;apos; The TOC must exist or this produces an error.</span></span>
<span class="line"><span style="color:#e1e4e8;">    On Error GoTo DontUpdate</span></span>
<span class="line"><span style="color:#e1e4e8;">   ActiveDocument.TablesOfContents(1).Update</span></span>
<span class="line"><span style="color:#e1e4e8;">   ActiveDocument.TablesOfContents(1).UpdatePageNumbers</span></span>
<span class="line"><span style="color:#e1e4e8;">    </span></span>
<span class="line"><span style="color:#e1e4e8;">DontUpdate:</span></span>
<span class="line"><span style="color:#e1e4e8;">    On Error GoTo 0</span></span>
<span class="line"><span style="color:#e1e4e8;">    </span></span>
<span class="line"><span style="color:#e1e4e8;">End Sub</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;/script:module&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;!DOCTYPE script:module PUBLIC &quot;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&quot; &quot;module.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;script:module xmlns:script=&quot;http://openoffice.org/2000/script&quot; script:name=&quot;Module1&quot; script:language=&quot;StarBasic&quot;&gt;Sub AutoOpen()</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos;</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos; AutoOpen Macro</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos;</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos;</span></span>
<span class="line"><span style="color:#24292e;">    &amp;apos; Update the entire first table of contents.</span></span>
<span class="line"><span style="color:#24292e;">    &amp;apos; The TOC must exist or this produces an error.</span></span>
<span class="line"><span style="color:#24292e;">    On Error GoTo DontUpdate</span></span>
<span class="line"><span style="color:#24292e;">   ActiveDocument.TablesOfContents(1).Update</span></span>
<span class="line"><span style="color:#24292e;">   ActiveDocument.TablesOfContents(1).UpdatePageNumbers</span></span>
<span class="line"><span style="color:#24292e;">    </span></span>
<span class="line"><span style="color:#24292e;">DontUpdate:</span></span>
<span class="line"><span style="color:#24292e;">    On Error GoTo 0</span></span>
<span class="line"><span style="color:#24292e;">    </span></span>
<span class="line"><span style="color:#24292e;">End Sub</span></span>
<span class="line"><span style="color:#24292e;">&lt;/script:module&gt;</span></span></code></pre></div><p>之后在<code>End Sub</code>之后新增一段函数</p><p>文件变为如下</p><div class="language-basic vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">basic</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;!DOCTYPE script:module PUBLIC &quot;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&quot; &quot;module.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;script:module xmlns:script=&quot;http://openoffice.org/2000/script&quot; script:name=&quot;Module1&quot; script:language=&quot;StarBasic&quot;&gt;Sub AutoOpen()</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos;</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos; AutoOpen Macro</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos;</span></span>
<span class="line"><span style="color:#e1e4e8;">&amp;apos;</span></span>
<span class="line"><span style="color:#e1e4e8;">    &amp;apos; Update the entire first table of contents.</span></span>
<span class="line"><span style="color:#e1e4e8;">    &amp;apos; The TOC must exist or this produces an error.</span></span>
<span class="line"><span style="color:#e1e4e8;">    On Error GoTo DontUpdate</span></span>
<span class="line"><span style="color:#e1e4e8;">   ActiveDocument.TablesOfContents(1).Update</span></span>
<span class="line"><span style="color:#e1e4e8;">   ActiveDocument.TablesOfContents(1).UpdatePageNumbers</span></span>
<span class="line"><span style="color:#e1e4e8;">    </span></span>
<span class="line"><span style="color:#e1e4e8;">DontUpdate:</span></span>
<span class="line"><span style="color:#e1e4e8;">    On Error GoTo 0</span></span>
<span class="line"><span style="color:#e1e4e8;">    </span></span>
<span class="line"><span style="color:#e1e4e8;">End Sub</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Sub UpdateIndexes(path As String)</span></span>
<span class="line"><span style="color:#e1e4e8;">     &amp;apos;&amp;apos;&amp;apos;Update indexes, such as for the table of contents&amp;apos;&amp;apos;&amp;apos; </span></span>
<span class="line"><span style="color:#e1e4e8;">     Dim doc As Object</span></span>
<span class="line"><span style="color:#e1e4e8;">     Dim args()</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">     doc = StarDesktop.loadComponentFromUrl(convertToUrl(path), &amp;quot;_default&amp;quot;, 0, args())</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">     Dim i As Integer</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">     With doc &amp;apos; Only process Writer documents</span></span>
<span class="line"><span style="color:#e1e4e8;">         If .supportsService(&amp;quot;com.sun.star.text.GenericTextDocument&amp;quot;) Then</span></span>
<span class="line"><span style="color:#e1e4e8;">             For i = 0 To .getDocumentIndexes().count - 1</span></span>
<span class="line"><span style="color:#e1e4e8;">                 .getDocumentIndexes().getByIndex(i).update()</span></span>
<span class="line"><span style="color:#e1e4e8;">             Next i</span></span>
<span class="line"><span style="color:#e1e4e8;">         End If</span></span>
<span class="line"><span style="color:#e1e4e8;">     End With &amp;apos; ThisComponent</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">     doc.store()</span></span>
<span class="line"><span style="color:#e1e4e8;">     doc.close(True)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"> End Sub &amp;apos; UpdateIndexes  </span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;/script:module&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;!DOCTYPE script:module PUBLIC &quot;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&quot; &quot;module.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;script:module xmlns:script=&quot;http://openoffice.org/2000/script&quot; script:name=&quot;Module1&quot; script:language=&quot;StarBasic&quot;&gt;Sub AutoOpen()</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos;</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos; AutoOpen Macro</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos;</span></span>
<span class="line"><span style="color:#24292e;">&amp;apos;</span></span>
<span class="line"><span style="color:#24292e;">    &amp;apos; Update the entire first table of contents.</span></span>
<span class="line"><span style="color:#24292e;">    &amp;apos; The TOC must exist or this produces an error.</span></span>
<span class="line"><span style="color:#24292e;">    On Error GoTo DontUpdate</span></span>
<span class="line"><span style="color:#24292e;">   ActiveDocument.TablesOfContents(1).Update</span></span>
<span class="line"><span style="color:#24292e;">   ActiveDocument.TablesOfContents(1).UpdatePageNumbers</span></span>
<span class="line"><span style="color:#24292e;">    </span></span>
<span class="line"><span style="color:#24292e;">DontUpdate:</span></span>
<span class="line"><span style="color:#24292e;">    On Error GoTo 0</span></span>
<span class="line"><span style="color:#24292e;">    </span></span>
<span class="line"><span style="color:#24292e;">End Sub</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Sub UpdateIndexes(path As String)</span></span>
<span class="line"><span style="color:#24292e;">     &amp;apos;&amp;apos;&amp;apos;Update indexes, such as for the table of contents&amp;apos;&amp;apos;&amp;apos; </span></span>
<span class="line"><span style="color:#24292e;">     Dim doc As Object</span></span>
<span class="line"><span style="color:#24292e;">     Dim args()</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">     doc = StarDesktop.loadComponentFromUrl(convertToUrl(path), &amp;quot;_default&amp;quot;, 0, args())</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">     Dim i As Integer</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">     With doc &amp;apos; Only process Writer documents</span></span>
<span class="line"><span style="color:#24292e;">         If .supportsService(&amp;quot;com.sun.star.text.GenericTextDocument&amp;quot;) Then</span></span>
<span class="line"><span style="color:#24292e;">             For i = 0 To .getDocumentIndexes().count - 1</span></span>
<span class="line"><span style="color:#24292e;">                 .getDocumentIndexes().getByIndex(i).update()</span></span>
<span class="line"><span style="color:#24292e;">             Next i</span></span>
<span class="line"><span style="color:#24292e;">         End If</span></span>
<span class="line"><span style="color:#24292e;">     End With &amp;apos; ThisComponent</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">     doc.store()</span></span>
<span class="line"><span style="color:#24292e;">     doc.close(True)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"> End Sub &amp;apos; UpdateIndexes  </span></span>
<span class="line"><span style="color:#24292e;">&lt;/script:module&gt;</span></span></code></pre></div><p>之后创建一个带目录的<code>docx</code>文件，把目录页码改成别的数字，之后执行命令如下，该命令会打开指定位置的文件，更新页码之后保存</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libreoffice</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--headless</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;macro:///Standard.Module1.UpdateIndexes(/path/to/my.docx)&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libreoffice</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--headless</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;macro:///Standard.Module1.UpdateIndexes(/path/to/my.docx)&quot;</span></span></code></pre></div><p><code>UpdateIndexes</code>内部的参数需要填写绝对路径</p><h2 id="unoconv-unoserver实现" tabindex="-1"><code>unoconv/unoserver</code>实现 <a class="header-anchor" href="#unoconv-unoserver实现" aria-label="Permalink to &quot;\`unoconv/unoserver\`实现&quot;">​</a></h2><h4 id="项目地址" tabindex="-1">项目地址 <a class="header-anchor" href="#项目地址" aria-label="Permalink to &quot;项目地址&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">https://github.com/unoconv/unoserver</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">https://github.com/unoconv/unoserver</span></span></code></pre></div><p>该项目是<code>https://github.com/unoconv/unoconv</code>的重构版本，维护活跃</p><p>首先查看最新的发布<code>tag</code>，当前<code>2023-10-08</code>的是<code>2.0b1</code>，在<code>2.0*</code>版本才有更新目录页码的功能</p><h4 id="组成结构" tabindex="-1">组成结构 <a class="header-anchor" href="#组成结构" aria-label="Permalink to &quot;组成结构&quot;">​</a></h4><ul><li><code>unoserver</code>: 运行时指定固定的<code>IP</code>和端口启动<code>libreoffice</code>侦听器</li><li><code>unoconvert</code>: 连接到侦听器并进行文档处理</li></ul><p>结构组成说明</p><p>比如在运行命令如下</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libreoffice</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--headless</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--convert-to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pdf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MyDocument.odf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libreoffice</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--headless</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--convert-to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pdf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MyDocument.odf</span></span></code></pre></div><p>这会将 <code>LibreOffice</code> 加载到内存中，转换文件，然后退出 <code>LibreOffice</code>，这意味着下次转换文档时，<code>LibreOffice</code> 需要再次加载到内存中</p><p>为了避免这种情况，<code>LibreOffice</code> 有一个侦听器模式，它可以通过端口侦听命令，并加载和转换文档，而无需退出和重新加载软件</p><p>优点</p><ul><li>这样会降低转换许多文档时的 <code>CPU</code> 负载，这意味着您可以使用侦听器同时转换两倍到四倍的文档</li></ul><p>缺点</p><ul><li>常驻内存导致会有一个持续的内存占用</li></ul><h4 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pip3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unoserver</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pip3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unoserver</span></span></code></pre></div><p>需要使用<code>sudo</code></p><ol><li><code>libreoffice</code>安装的时候，会使用到系统<code>python</code>，同时会存在一个文件<code>/usr/lib/python3/dist-packages/uno.py</code>包含工具包，导入<code>/usr/lib/libreoffice/program</code>路径下面的<code>*.so</code>文件</li><li>使用<code>sudo pip3</code>一般可以确定指向系统<code>python</code></li></ol><p>程序分为服务端和客户端</p><p>首先执行服务端，如下命令会启动<code>libreoffice</code>并监听<code>2002</code>端口</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unoserver</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unoserver</span></span></code></pre></div><p><code>unoserver</code>进程占用内存<code>72M</code>左右</p><p>该进程会派生出两个子进程</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># 占用内存4M左右</span></span>
<span class="line"><span style="color:#e1e4e8;">/usr/lib/libreoffice/program/oosplash --headless ....</span></span>
<span class="line"><span style="color:#e1e4e8;"># 未转换文件前占用内存100M左右，一旦开始转换后，增长到200M~300M</span></span>
<span class="line"><span style="color:#e1e4e8;">/usr/lib/libreoffice/program/soffice.bin ...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># 占用内存4M左右</span></span>
<span class="line"><span style="color:#24292e;">/usr/lib/libreoffice/program/oosplash --headless ....</span></span>
<span class="line"><span style="color:#24292e;"># 未转换文件前占用内存100M左右，一旦开始转换后，增长到200M~300M</span></span>
<span class="line"><span style="color:#24292e;">/usr/lib/libreoffice/program/soffice.bin ...</span></span></code></pre></div><p><strong>所以侦听器模式一般会稳定消耗内存<code>300~400M</code>左右，但是可以换取较大性能提升，每次转换文件不需要读取磁盘加载<code>libreoffice</code>程序</strong></p><p><strong>侦听器随着转换文档数量的增长，占用内存也会持续上升，可以定期重启侦听器程序以避免该问题</strong></p><p>新开一个终端，调用客户端程序，更新目录，比如存在一个目录页码错误的<code>test-toc.docx</code>，执行更新生成一个新文件到<code>test-toc-a.docx</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">usage: unoconvert [-h] [--convert-to CONVERT_TO] [--filter FILTER] [--filter-options FILTER_OPTIONS] [--update-index]</span></span>
<span class="line"><span style="color:#e1e4e8;">                  [--dont-update-index] [--host HOST] [--port PORT] [--host-location {auto,remote,local}]</span></span>
<span class="line"><span style="color:#e1e4e8;">                  infile outfile</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">usage: unoconvert [-h] [--convert-to CONVERT_TO] [--filter FILTER] [--filter-options FILTER_OPTIONS] [--update-index]</span></span>
<span class="line"><span style="color:#24292e;">                  [--dont-update-index] [--host HOST] [--port PORT] [--host-location {auto,remote,local}]</span></span>
<span class="line"><span style="color:#24292e;">                  infile outfile</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unoconvert</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--convert-to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test-toc.docx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test-toc-a.docx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unoconvert</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--convert-to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test-toc.docx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test-toc-a.docx</span></span></code></pre></div><p>或者也可以转换为<code>pdf</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unoconvert</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--convert-to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pdf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test-toc.docx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test-toc.pdf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unoconvert</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--convert-to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pdf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test-toc.docx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test-toc.pdf</span></span></code></pre></div><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-label="Permalink to &quot;扩展阅读&quot;">​</a></h2><p>也可以直接使用<code>libreoffice</code>进行文档类型转换，比如文件名称是<code>my.docx</code></p><p>转变为<code>pdf</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libreoffice</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--headless</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--convert-to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pdf:writer_pdf_Export</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my.docx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--outdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libreoffice</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--headless</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--convert-to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pdf:writer_pdf_Export</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my.docx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--outdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span></code></pre></div><p>转变为<code>html</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libreoffice</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--headless</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--convert-to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;html:XHTML Writer File:UTF8&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my.docx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--outdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libreoffice</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--headless</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--convert-to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;html:XHTML Writer File:UTF8&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my.docx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--outdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span></code></pre></div><p><code>libreoffice</code>推荐采用<code>docker</code>版本的</p><ul><li><p><code>unoserver</code>维护的，地址</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">https://github.com/unoconv/unoserver-docker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">https://github.com/unoconv/unoserver-docker</span></span></code></pre></div><p><code>docker</code>镜像库地址</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">https://github.com/unoconv/unoserver-docker/pkgs/container/unoserver-docker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">https://github.com/unoconv/unoserver-docker/pkgs/container/unoserver-docker</span></span></code></pre></div></li><li><p><code>linuxserver/libreoffice</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">https://hub.docker.com/r/linuxserver/libreoffice</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">https://hub.docker.com/r/linuxserver/libreoffice</span></span></code></pre></div></li></ul><h2 id="参考阅读" tabindex="-1">参考阅读 <a class="header-anchor" href="#参考阅读" aria-label="Permalink to &quot;参考阅读&quot;">​</a></h2><p><a href="https://ask.libreoffice.org/t/update-toc-via-command-line/52518" target="_blank" rel="noreferrer"><code>Update TOC via command line</code></a></p>`,62),l=[p];function t(c,r,i,d,y,u){return a(),e("div",null,l)}const g=s(o,[["render",t]]);export{E as __pageData,g as default};
